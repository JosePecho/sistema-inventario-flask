{% extends "layout_fixed.html" %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">üë§ Mi Cuenta</h1>
            <div class="breadcrumb">
                <a href="{{ url_for('dashboard') }}">Dashboard</a>
                <i class="fas fa-chevron-right"></i>
                <span>Mi Cuenta</span>
            </div>
        </div>
        <div class="header-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Volver al Dashboard
            </a>
        </div>
    </div>

    <div class="account-container">
        <!-- Secci√≥n de Foto de Perfil -->
        <div class="profile-section">
            <div class="profile-header">
                <h2><i class="fas fa-user-circle"></i> Foto de Perfil</h2>
                <p>Personaliza tu cuenta con una foto</p>
            </div>
            
            <div class="profile-content">
                <div class="profile-photo-container">
                    <div class="photo-preview" id="photoPreview">
                        {% if usuario.foto_perfil %}
                            <img src="{{ url_for('static', filename=usuario.foto_perfil) }}" 
                                 alt="Foto de perfil" 
                                 class="profile-image"
                                 id="profileImage">
                            <div class="photo-overlay">
                                <span class="photo-status">‚úÖ Foto actual</span>
                            </div>
                        {% else %}
                            <div class="no-photo">
                                <i class="fas fa-user fa-4x"></i>
                                <p>Sin foto</p>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="photo-actions">
                        <form action="{{ url_for('actualizar_foto_perfil') }}" 
                              method="POST" 
                              enctype="multipart/form-data"
                              class="photo-form"
                              id="photoForm">
                            <input type="file" 
                                   name="foto_perfil" 
                                   id="fotoInput" 
                                   accept="image/*"
                                   style="display: none;"
                                   onchange="previewPhoto(event)">
                            
                            <button type="button" 
                                    class="btn btn-primary btn-upload"
                                    onclick="document.getElementById('fotoInput').click()">
                                <i class="fas fa-camera"></i> Subir Foto
                            </button>
                            
                            <button type="submit" 
                                    class="btn btn-success btn-save"
                                    id="btnSavePhoto"
                                    style="display: none;">
                                <i class="fas fa-save"></i> Guardar Cambios
                            </button>
                            
                            {% if usuario.foto_perfil %}
                            <button type="button" 
                                    class="btn btn-danger btn-remove"
                                    onclick="confirmDeletePhoto()">
                                <i class="fas fa-trash"></i> Eliminar Foto
                            </button>
                            {% endif %}
                        </form>
                        
                        <form action="{{ url_for('eliminar_foto_perfil') }}" 
                              method="POST" 
                              id="deletePhotoForm"
                              style="display: none;">
                        </form>
                        
                        <div class="photo-info">
                            <p><i class="fas fa-info-circle"></i> Formatos permitidos: JPG, PNG, GIF</p>
                            <p><i class="fas fa-info-circle"></i> Tama√±o m√°ximo: 5 MB</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Informaci√≥n Personal -->
        <div class="info-section">
            <div class="section-header">
                <h2><i class="fas fa-user"></i> Informaci√≥n Personal</h2>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-user-tag"></i>
                    </div>
                    <div class="info-content">
                        <h3>Usuario</h3>
                        <p class="info-value">{{ usuario.username }}</p>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-id-card"></i>
                    </div>
                    <div class="info-content">
                        <h3>Nombre Completo</h3>
                        <p class="info-value">{{ usuario.nombre }}</p>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="info-content">
                        <h3>Tipo de Cuenta</h3>
                        <p class="info-value">
                            {% if usuario.es_admin %}
                            <span class="badge admin">Administrador</span>
                            {% else %}
                            <span class="badge user">Usuario</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n de Acciones -->
        <div class="actions-section">
            <div class="section-header">
                <h2><i class="fas fa-cogs"></i> Acciones de Cuenta</h2>
            </div>
            
            <div class="actions-grid">
                <a href="{{ url_for('dashboard') }}" class="action-card primary">
                    <div class="action-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <h3>Dashboard</h3>
                    <p>Ir al panel principal</p>
                </a>
                
                <a href="{{ url_for('productos') }}" class="action-card secondary">
                    <div class="action-icon">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <h3>Productos</h3>
                    <p>Gestionar inventario</p>
                </a>
                
                <a href="{{ url_for('reportes') }}" class="action-card success">
                    <div class="action-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h3>Reportes</h3>
                    <p>Ver estad√≠sticas</p>
                </a>
                
                <a href="{{ url_for('logout') }}" class="action-card danger">
                    <div class="action-icon">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                    <h3>Cerrar Sesi√≥n</h3>
                    <p>Salir del sistema</p>
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    function previewPhoto(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // Validar tama√±o (5MB m√°ximo)
        if (file.size > 5 * 1024 * 1024) {
            alert('La imagen es muy grande. M√°ximo 5MB.');
            return;
        }
        
        // Validar tipo
        const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
        if (!validTypes.includes(file.type)) {
            alert('Formato no v√°lido. Use JPG, PNG o GIF.');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            // Actualizar vista previa
            const photoPreview = document.getElementById('photoPreview');
            const profileImage = document.getElementById('profileImage');
            
            if (profileImage) {
                profileImage.src = e.target.result;
            } else {
                photoPreview.innerHTML = `
                    <img src="${e.target.result}" 
                         alt="Foto de perfil" 
                         class="profile-image"
                         id="profileImage">
                    <div class="photo-overlay">
                        <span class="photo-status">üîÑ Vista previa</span>
                    </div>
                `;
            }
            
            // Mostrar bot√≥n de guardar
            document.getElementById('btnSavePhoto').style.display = 'inline-block';
        };
        
        reader.readAsDataURL(file);
    }
    
    function confirmDeletePhoto() {
        if (confirm('¬øEst√°s seguro de que quieres eliminar tu foto de perfil?')) {
            document.getElementById('deletePhotoForm').submit();
        }
    }
    
    // Limpiar formulario si se cancela
    document.getElementById('fotoInput').addEventListener('change', function() {
        if (!this.value) {
            document.getElementById('btnSavePhoto').style.display = 'none';
        }
    });
</script>

<style>
    /* Contenedor principal */
    .page-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #2c3e50, #34495e);
        border-radius: 12px;
        color: white;
    }

    .header-content h1 {
        margin: 0 0 0.5rem 0;
        font-size: 1.8rem;
    }

    .breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        opacity: 0.9;
    }

    .breadcrumb a {
        color: #3498db;
        text-decoration: none;
    }

    /* Contenedor de cuenta */
    .account-container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    /* Secci√≥n de perfil */
    .profile-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        padding: 2rem;
        border: 1px solid #e8e8e8;
    }

    .profile-header h2 {
        margin: 0 0 0.5rem 0;
        color: #2c3e50;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .profile-header p {
        margin: 0;
        color: #7f8c8d;
        font-size: 0.95rem;
    }

    .profile-content {
        margin-top: 1.5rem;
    }

    .profile-photo-container {
        display: flex;
        align-items: center;
        gap: 3rem;
        flex-wrap: wrap;
    }

    .photo-preview {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        overflow: hidden;
        position: relative;
        border: 4px solid #3498db;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
    }

    .profile-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .no-photo {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        color: #95a5a6;
    }

    .no-photo i {
        margin-bottom: 1rem;
    }

    .photo-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 0.5rem;
        text-align: center;
        font-size: 0.85rem;
    }

    .photo-actions {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        min-width: 300px;
    }

    .photo-form {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .btn-upload, .btn-save, .btn-remove {
        padding: 0.8rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
    }

    .btn-upload {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }

    .btn-save {
        background: linear-gradient(135deg, #27ae60, #219653);
        color: white;
    }

    .btn-remove {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
    }

    .btn-upload:hover, .btn-save:hover, .btn-remove:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .photo-info {
        background: #f8f9fa;
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }

    .photo-info p {
        margin: 0.3rem 0;
        font-size: 0.9rem;
        color: #2c3e50;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Secci√≥n de informaci√≥n */
    .info-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        padding: 2rem;
        border: 1px solid #e8e8e8;
    }

    .section-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }

    .section-header h2 {
        margin: 0;
        color: #2c3e50;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .info-card {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 10px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1.5rem;
        border: 1px solid #dee2e6;
        transition: all 0.3s;
    }

    .info-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    }

    .info-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #3498db, #2980b9);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .info-content h3 {
        margin: 0 0 0.3rem 0;
        color: #2c3e50;
        font-size: 1.1rem;
    }

    .info-value {
        margin: 0;
        color: #495057;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .badge {
        display: inline-block;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .badge.admin {
        background: #d4edda;
        color: #155724;
    }

    .badge.user {
        background: #d1ecf1;
        color: #0c5460;
    }

    /* Secci√≥n de acciones */
    .actions-section {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        padding: 2rem;
        border: 1px solid #e8e8e8;
    }

    .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
    }

    .action-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        text-decoration: none;
        border: 2px solid #e9ecef;
        transition: all 0.3s;
        display: block;
    }

    .action-card:hover {
        transform: translateY(-5px);
        text-decoration: none;
    }

    .action-card.primary:hover {
        border-color: #3498db;
        box-shadow: 0 6px 15px rgba(52, 152, 219, 0.2);
    }

    .action-card.secondary:hover {
        border-color: #6c757d;
        box-shadow: 0 6px 15px rgba(108, 117, 125, 0.2);
    }

    .action-card.success:hover {
        border-color: #28a745;
        box-shadow: 0 6px 15px rgba(40, 167, 69, 0.2);
    }

    .action-card.danger:hover {
        border-color: #dc3545;
        box-shadow: 0 6px 15px rgba(220, 53, 69, 0.2);
    }

    .action-icon {
        width: 50px;
        height: 50px;
        margin: 0 auto 1rem;
        background: #f8f9fa;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
    }

    .action-card.primary .action-icon {
        background: #e3f2fd;
        color: #3498db;
    }

    .action-card.secondary .action-icon {
        background: #e2e3e5;
        color: #6c757d;
    }

    .action-card.success .action-icon {
        background: #d4edda;
        color: #28a745;
    }

    .action-card.danger .action-icon {
        background: #f8d7da;
        color: #dc3545;
    }

    .action-card h3 {
        margin: 0 0 0.5rem 0;
        color: #2c3e50;
        font-size: 1.2rem;
    }

    .action-card p {
        margin: 0;
        color: #6c757d;
        font-size: 0.9rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
        }
        
        .profile-photo-container {
            flex-direction: column;
            text-align: center;
        }
        
        .photo-preview {
            width: 150px;
            height: 150px;
        }
        
        .photo-actions {
            min-width: 100%;
        }
        
        .photo-form {
            justify-content: center;
        }
        
        .info-grid, .actions-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .profile-section, .info-section, .actions-section {
            padding: 1.5rem;
        }
        
        .photo-form {
            flex-direction: column;
        }
        
        .btn-upload, .btn-save, .btn-remove {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}